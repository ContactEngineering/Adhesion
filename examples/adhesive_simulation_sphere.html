<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adhesive Simulation of the contact of a sphere &mdash; Adhesion 0.91.0.dev102+gcabb2ea1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example of rough simulation with adhesion on the contact challenge 512x512 topography" href="adhesive_simulation_rough.html" />
    <link rel="prev" title="Examples" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Adhesion
          </a>
              <div class="version">
                0.91.0.dev102+gcabb2ea1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Notes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to Adhesion</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Adhesive Simulation of the contact of a sphere</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prepare-geometry">Prepare Geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-system">Setup system</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#choosing-appropriate-discretization">Choosing appropriate discretization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulate">Simulate</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#plot-pressure-distributions-and-deformed-profiles">plot pressure distributions and deformed profiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scalar-quantities-during-loading">Scalar quantities during loading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#further-experiments">Further experiments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="adhesive_simulation_rough.html">Example of rough simulation with adhesion on the contact challenge 512x512 topography</a></li>
<li class="toctree-l2"><a class="reference internal" href="adhesive_plastic_simulation_cone.html">Adhesive Plastic Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="sinewave_bem_vs_jkr.html">Smooth against JKR</a></li>
<li class="toctree-l2"><a class="reference internal" href="sinewave_bem_vs_jkr.html#hardwall-against-jkr">Hardwall against JKR</a></li>
<li class="toctree-l2"><a class="reference internal" href="contacting_points.html">computing contact areas</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../source/Adhesion.Interactions.html">Adhesion.Interactions package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/Adhesion.System.html">Adhesion.System package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/Adhesion.ReferenceSolutions.html">Adhesion.ReferenceSolutions package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Adhesion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Examples</a></li>
      <li class="breadcrumb-item active">Adhesive Simulation of the contact of a sphere</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/adhesive_simulation_sphere.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ---</span>
<span class="c1"># jupyter:</span>
<span class="c1">#   jupytext:</span>
<span class="c1">#     formats: py:percent</span>

<span class="c1">#     text_representation:</span>
<span class="c1">#       extension: .py</span>
<span class="c1">#       format_name: percent</span>
<span class="c1">#       format_version: &#39;1.3&#39;</span>
<span class="c1">#       jupytext_version: 1.14.4</span>
<span class="c1">#   kernelspec:</span>
<span class="c1">#     display_name: Python 3</span>
<span class="c1">#     language: python</span>
<span class="c1">#     name: python3</span>
<span class="c1"># ---</span>
</pre></div>
</div>
</div>
</div>
<section id="adhesive-simulation-of-the-contact-of-a-sphere">
<h1>Adhesive Simulation of the contact of a sphere<a class="headerlink" href="#adhesive-simulation-of-the-contact-of-a-sphere" title="Permalink to this heading"></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">Adhesion.Interactions</span> <span class="kn">import</span> <span class="n">PowerLaw</span>
<span class="kn">from</span> <span class="nn">Adhesion.System</span> <span class="kn">import</span> <span class="n">BoundedSmoothContactSystem</span>
<span class="kn">from</span> <span class="nn">ContactMechanics.Tools.Logger</span> <span class="kn">import</span> <span class="n">Logger</span>
<span class="kn">from</span> <span class="nn">SurfaceTopography.Special</span> <span class="kn">import</span> <span class="n">make_sphere</span>
<span class="kn">from</span> <span class="nn">NuMPI.IO.NetCDF</span> <span class="kn">import</span> <span class="n">NCStructuredGrid</span>
<span class="kn">from</span> <span class="nn">Adhesion.ReferenceSolutions</span> <span class="kn">import</span> <span class="n">JKR</span>
</pre></div>
</div>
</div>
</div>
<p>Nondimensionalisation using the JKR units following the convensions in Maugis’ book.
See https://contactengineering.github.io/Adhesion/source/Adhesion.ReferenceSolutions.html#module-Adhesion.ReferenceSolutions.JKR and/or https://doi.org/10.1016/j.jmps.2022.104781 , https://doi.org/10.1088/0022-3727/41/16/163001</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">w</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">Es</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
</div>
<section id="prepare-geometry">
<h2>Prepare Geometry<a class="headerlink" href="#prepare-geometry" title="Permalink to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span>

<span class="n">sx</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">sy</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sx</span> <span class="o">/</span> <span class="n">nx</span> <span class="o">-</span> <span class="n">sx</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sy</span> <span class="o">/</span> <span class="n">ny</span> <span class="o">-</span> <span class="n">sy</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">make_sphere</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="n">R</span><span class="p">,</span> <span class="n">nb_grid_pts</span><span class="o">=</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">),</span> <span class="n">physical_sizes</span><span class="o">=</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">),</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;paraboloid&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">t</span><span class="o">.</span><span class="n">heights</span><span class="p">()),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;heights&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x ($z_0$)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y ($z_0$)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;y ($z_0$)&#39;)
</pre></div>
</div>
<img alt="../_images/ca3da55ad7b4f26a5c5498e16e0bd0eebaca996f2f431a60290602bb4a48e35a.png" src="../_images/ca3da55ad7b4f26a5c5498e16e0bd0eebaca996f2f431a60290602bb4a48e35a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">heights</span><span class="p">()[:,</span> <span class="n">ny</span> <span class="o">//</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x ($z_0$)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;heights ($z_0$)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;heights ($z_0$)&#39;)
</pre></div>
</div>
<img alt="../_images/06b9ff2715411cfb29abb94823dad8243b31a898c3139f8528073bd217e0248f.png" src="../_images/06b9ff2715411cfb29abb94823dad8243b31a898c3139f8528073bd217e0248f.png" />
</div>
</div>
</section>
<section id="setup-system">
<h2>Setup system<a class="headerlink" href="#setup-system" title="Permalink to this heading"></a></h2>
<section id="choosing-appropriate-discretization">
<h3>Choosing appropriate discretization<a class="headerlink" href="#choosing-appropriate-discretization" title="Permalink to this heading"></a></h3>
<p>Guideline for appropriate discretisation.</p>
<p>With the exponential and the cubic interaction potential close to the JKR limit, the pixel size needs to be smaller than $2\rho^2$ (in JKR units).</p>
<p>$$
dx \leq 2 \rho^2 \frac{4}{3\pi} \frac{1}{\ell_a}
$$</p>
<p>with $\ell_a = w_{int} / E^\prime$</p>
<p>Note: I determined the numerical factor empirically for the exponential and the cubic potential in the dataset c83b545e-1385-47a7-adc6-ac9a24c02e39, discretisation_hysteresis_overview.html.</p>
<p>Several arguments lead to this scaling relation:</p>
<ol class="arabic simple">
<li><p>More than one pixels need to fall within the range of interaction at the edge of the contact. We estimate the gap at the contact edge using the JKR equation.</p></li>
<li><p>The region where the stresses peak to the maximimum cohesive stress is called the cohesive zone and needs to include more than one pixel. The width of this region can be estimated from the region where the square-root singular stresses of the JKR solution exceed the max interaction stress. See e.g. <a class="reference external" href="https://eds.s.ebscohost.com/abstract?site=eds&amp;scope=site&amp;jrnl=03542025&amp;AN=102396230&amp;h=iFXqZ3C8CtweMQrf8a%2bDvdqqxAsDZsUJqlRrgcoUV9RtbO3xhCb%2be%2b8cXCY4qScc%2fzZSOR7GTlUaVs8neUuNAw%3d%3d&amp;crl=f&amp;resultLocal=ErrCrlNoResults&amp;resultNs=Ehost&amp;crlhashurl=login.aspx%3fdirect%3dtrue%26profile%3dehost%26scope%3dsite%26authtype%3dcrawler%26jrnl%3d03542025%26AN%3d102396230">Pohrt and Popov 2015</a>.</p></li>
<li><p>The elastic coupling between neighboring pixels (the stiffness associeted with the highest Fourier mode $\sim E^* / \Delta x$) should be stronger than the stiffness of the interaction force $\phi^{\prime\prime}$. This requirement means that $\min(\phi^{\prime\prime}) \sim w / \rho^2 &lt; E^* / \Delta x$, up to a numerical prefactor.
This argument was put forward by <a class="reference external" href="https://doi.org/10.3390/lubricants9020017">Wang, Zhou and Müser 2021</a> (See Equation (9) and Fig.8).</p></li>
<li><p><span class="xref myst">Persson and Scarraggi</span>, Appendix A: Consider a penny-shaped crack of size one pixel. In the continuum and JKR limit, a penny shaped crack propagates at a a critical stress $\sim \sqrt{w E \Delta x}$. If the interaction strength is larger than this value, the crack will grow at larger stresses than predicted by the continuum, JKR limit, leading to artificially large adhesion.</p></li>
</ol>
<p>Arguments similar to 2 and 4  lead to an implementation of adhesion using a pixel detachment criterion in Refs. <a class="reference external" href="http://dx.doi.org/10.1007/s10409-016-0630-y">Hulikal et al. 2017</a> and <a class="reference external" href="https://eds.s.ebscohost.com/abstract?site=eds&amp;scope=site&amp;jrnl=03542025&amp;AN=102396230&amp;h=iFXqZ3C8CtweMQrf8a%2bDvdqqxAsDZsUJqlRrgcoUV9RtbO3xhCb%2be%2b8cXCY4qScc%2fzZSOR7GTlUaVs8neUuNAw%3d%3d&amp;crl=f&amp;resultLocal=ErrCrlNoResults&amp;resultNs=Ehost&amp;crlhashurl=login.aspx%3fdirect%3dtrue%26profile%3dehost%26scope%3dsite%26authtype%3dcrawler%26jrnl%3d03542025%26AN%3d102396230">Pohrt and Popov 2015</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interaction_range</span> <span class="o">=</span> <span class="mf">0.1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="n">pixel_size</span> <span class="o">/</span> <span class="n">interaction_range</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1.953125, 1.953125])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># cubic interaction potential</span>
<span class="n">interaction</span> <span class="o">=</span> <span class="n">PowerLaw</span><span class="p">(</span><span class="n">w</span><span class="p">,</span>
                       <span class="c1"># v that way the max stress is still w / rho</span>
                       <span class="mi">3</span> <span class="o">*</span> <span class="n">interaction_range</span><span class="p">,</span>
                       <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">interaction_range</span><span class="p">)</span>
<span class="k">for</span> <span class="n">poti</span> <span class="ow">in</span> <span class="p">[</span><span class="n">interaction</span><span class="p">]:</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">poti</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;potential&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;force&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;curvature&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">a</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;gap&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/77277522f00ab5e919a87d31f3556c1494aa83b683617d2362069282e71c9534.png" src="../_images/77277522f00ab5e919a87d31f3556c1494aa83b683617d2362069282e71c9534.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">system</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">make_contact_system</span><span class="p">(</span>
    <span class="n">interaction</span><span class="o">=</span><span class="n">interaction</span><span class="p">,</span>
    <span class="n">system_class</span><span class="o">=</span><span class="n">BoundedSmoothContactSystem</span><span class="p">,</span>
    <span class="n">young</span><span class="o">=</span><span class="n">Es</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="loading-history">
<h4>loading history<a class="headerlink" href="#loading-history" title="Permalink to this heading"></a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">penetrations</span><span class="p">(</span><span class="n">start_pen</span><span class="p">,</span> <span class="n">max_pen</span><span class="p">,</span> <span class="n">dpen</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The advantage of using this function is that it generates penetrations that are exactly the same during approach and retraction. </span>
<span class="sd">    </span>
<span class="sd">    naively incrementing like `penetration += dpen` gives slightly different values due to numerical roundoff errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># integer penetration value</span>
    <span class="n">pen</span> <span class="o">=</span> <span class="n">start_pen</span> <span class="o">+</span> <span class="n">dpen</span> <span class="o">*</span> <span class="n">i</span>
    <span class="k">yield</span> <span class="n">pen</span>
    <span class="k">while</span> <span class="n">pen</span> <span class="o">&lt;</span> <span class="n">max_pen</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">pen</span> <span class="o">=</span> <span class="n">start_pen</span> <span class="o">+</span> <span class="n">dpen</span> <span class="o">*</span> <span class="n">i</span>
        <span class="k">yield</span> <span class="n">pen</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">pen</span> <span class="o">=</span> <span class="n">start_pen</span> <span class="o">+</span> <span class="n">dpen</span> <span class="o">*</span> <span class="n">i</span>
        <span class="k">yield</span> <span class="n">pen</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start_pen</span> <span class="o">=</span> <span class="o">-</span> <span class="n">interaction</span><span class="o">.</span><span class="n">cutoff_radius</span>  <span class="c1"># before the jump into contact instability</span>
<span class="n">max_pen</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">dpen</span> <span class="o">=</span> <span class="mf">0.2</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="simulate">
<h3>Simulate<a class="headerlink" href="#simulate" title="Permalink to this heading"></a></h3>
<p>Choice of the gradient tolerance: The gradient is the error in the balance
of the elastic-force and the adhesive force on each pixel.</p>
<p>This error should be small compared to this force.</p>
<p>For simulations with adhesion close to the JKR limit, the maximum stress is usually given by the interaction.</p>
<p>In the DMT regime, it would be given by the contact</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gtol</span> <span class="o">=</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">interaction</span><span class="o">.</span><span class="n">max_tensile</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">.</span><span class="n">area_per_pt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create outputfile</span>
<span class="n">ncfilename</span> <span class="o">=</span> <span class="s2">&quot;sphere_simulation_hardwall_cubic.nc&quot;</span>
<span class="n">nc</span> <span class="o">=</span> <span class="n">NCStructuredGrid</span><span class="p">(</span><span class="n">ncfilename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">nb_domain_grid_pts</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">nb_grid_pts</span><span class="p">)</span>

<span class="n">disp0</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">penetration_prev</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">penetration</span> <span class="ow">in</span> <span class="n">penetrations</span><span class="p">(</span><span class="n">start_pen</span><span class="p">,</span> <span class="n">max_pen</span><span class="p">,</span> <span class="n">dpen</span><span class="p">):</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;penetration = </span><span class="si">{</span><span class="n">penetration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">minimize_proxy</span><span class="p">(</span>
        <span class="n">initial_displacements</span><span class="o">=</span><span class="n">disp0</span><span class="p">,</span>
        <span class="n">options</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">gtol</span><span class="o">=</span><span class="n">gtol</span><span class="p">,</span>  <span class="c1"># max absolute value of the gradient of the objective for convergence</span>
                     <span class="n">ftol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># stop only if the gradient criterion is fullfilled</span>
                     <span class="n">maxcor</span><span class="o">=</span><span class="mi">3</span>  <span class="c1"># number of gradients stored for hessian approximation</span>
                     <span class="p">),</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">Logger</span><span class="p">(</span><span class="s2">&quot;laststep.log&quot;</span><span class="p">),</span>
        <span class="n">offset</span><span class="o">=</span><span class="n">penetration</span><span class="p">,</span>
        <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">sol</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">message</span>
    <span class="n">disp0</span> <span class="o">=</span> <span class="n">u</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">disp</span>

    <span class="c1"># dumping results</span>
    <span class="n">fr</span> <span class="o">=</span> <span class="n">nc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">fr</span><span class="o">.</span><span class="n">penetration</span> <span class="o">=</span> <span class="n">penetration</span>
    <span class="n">fr</span><span class="o">.</span><span class="n">normal_force</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">compute_normal_force</span><span class="p">()</span>
    <span class="n">fr</span><span class="o">.</span><span class="n">contact_area</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">compute_contact_area</span><span class="p">()</span>
    <span class="n">fr</span><span class="o">.</span><span class="n">repulsive_area</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">compute_repulsive_contact_area</span><span class="p">()</span>
    <span class="n">fr</span><span class="o">.</span><span class="n">pressures</span> <span class="o">=</span> <span class="o">-</span> <span class="n">system</span><span class="o">.</span><span class="n">substrate</span><span class="o">.</span><span class="n">evaluate_force</span><span class="p">(</span><span class="n">u</span><span class="p">)[</span>
        <span class="n">system</span><span class="o">.</span><span class="n">substrate</span><span class="o">.</span><span class="n">topography_subdomain_slices</span><span class="p">]</span> <span class="o">/</span> <span class="n">system</span><span class="o">.</span><span class="n">area_per_pt</span>
    <span class="n">fr</span><span class="o">.</span><span class="n">elastic_displacements</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">disp</span><span class="p">[</span><span class="n">system</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">subdomain_slices</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">penetration</span> <span class="o">&lt;</span> <span class="n">penetration_prev</span> <span class="ow">and</span> <span class="n">fr</span><span class="o">.</span><span class="n">contact_area</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;left contact&quot;</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="n">penetration_prev</span> <span class="o">=</span> <span class="n">penetration</span>

    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">nc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = -0.30000000000000004
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = -0.10000000000000003
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 0.09999999999999998
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 0.30000000000000004
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 0.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 0.7
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 0.9000000000000001
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 1.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 1.3
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 1.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 1.3
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 1.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 0.9000000000000001
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 0.7
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 0.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>penetration = 0.30000000000000004
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">line</span> <span class="mi">12</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="k">for</span> <span class="n">penetration</span> <span class="ow">in</span> <span class="n">penetrations</span><span class="p">(</span><span class="n">start_pen</span><span class="p">,</span> <span class="n">max_pen</span><span class="p">,</span> <span class="n">dpen</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;penetration = </span><span class="si">{</span><span class="n">penetration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">12</span>     <span class="n">sol</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">minimize_proxy</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>         <span class="n">initial_displacements</span><span class="o">=</span><span class="n">disp0</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>         <span class="n">options</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">gtol</span><span class="o">=</span><span class="n">gtol</span><span class="p">,</span>  <span class="c1"># max absolute value of the gradient of the objective for convergence</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>                      <span class="n">ftol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># stop only if the gradient criterion is fullfilled</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>                      <span class="n">maxcor</span><span class="o">=</span><span class="mi">3</span>  <span class="c1"># number of gradients stored for hessian approximation</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>                      <span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>         <span class="n">logger</span><span class="o">=</span><span class="n">Logger</span><span class="p">(</span><span class="s2">&quot;laststep.log&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>         <span class="n">offset</span><span class="o">=</span><span class="n">penetration</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>         <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span>     <span class="k">assert</span> <span class="n">sol</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">message</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>     <span class="n">disp0</span> <span class="o">=</span> <span class="n">u</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">disp</span>

<span class="nn">File ~/work/Adhesion/venv/lib/python3.8/site-packages/Adhesion/System/Systems.py:1072,</span> in <span class="ni">BoundedSmoothContactSystem.minimize_proxy</span><span class="nt">(self, offset, initial_displacements, method, gradient, lbounds, ubounds, callback, logger, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1070</span> <span class="k">if</span> <span class="n">lbounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1071</span>     <span class="n">lbounds</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1072</span> <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">minimize_proxy</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1073</span>                               <span class="n">initial_displacements</span><span class="o">=</span><span class="n">initial_displacements</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1074</span>                               <span class="n">gradient</span><span class="o">=</span><span class="n">gradient</span><span class="p">,</span> <span class="n">lbounds</span><span class="o">=</span><span class="n">lbounds</span><span class="p">,</span> <span class="n">ubounds</span><span class="o">=</span><span class="n">ubounds</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1075</span>                               <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1076</span>                               <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/work/Adhesion/venv/lib/python3.8/site-packages/ContactMechanics/Systems.py:327,</span> in <span class="ni">SystemBase.minimize_proxy</span><span class="nt">(self, offset, initial_displacements, method, gradient, lbounds, ubounds, callback, logger, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">324</span> <span class="n">bounded_minimizers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="s1">&#39;TNC&#39;</span><span class="p">,</span> <span class="s1">&#39;SLSQP&#39;</span><span class="p">}</span>
<span class="g g-Whitespace">    </span><span class="mi">326</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">bounded_minimizers</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">327</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span>         <span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">initial_displacements</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span>         <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">gradient</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">330</span>         <span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span>         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">332</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">333</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">334</span>         <span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">initial_displacements</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">335</span>         <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">gradient</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">336</span>         <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/work/Adhesion/venv/lib/python3.8/site-packages/scipy/optimize/_minimize.py:696,</span> in <span class="ni">minimize</span><span class="nt">(fun, x0, args, method, jac, hess, hessp, bounds, constraints, tol, callback, options)</span>
<span class="g g-Whitespace">    </span><span class="mi">693</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">_minimize_newtoncg</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">jac</span><span class="p">,</span> <span class="n">hess</span><span class="p">,</span> <span class="n">hessp</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">694</span>                              <span class="o">**</span><span class="n">options</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">695</span> <span class="k">elif</span> <span class="n">meth</span> <span class="o">==</span> <span class="s1">&#39;l-bfgs-b&#39;</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">696</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">_minimize_lbfgsb</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">jac</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">697</span>                            <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">698</span> <span class="k">elif</span> <span class="n">meth</span> <span class="o">==</span> <span class="s1">&#39;tnc&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">699</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">_minimize_tnc</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">jac</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">700</span>                         <span class="o">**</span><span class="n">options</span><span class="p">)</span>

<span class="nn">File ~/work/Adhesion/venv/lib/python3.8/site-packages/scipy/optimize/_lbfgsb_py.py:350,</span> in <span class="ni">_minimize_lbfgsb</span><span class="nt">(fun, x0, args, jac, bounds, disp, maxcor, ftol, gtol, eps, maxfun, maxiter, iprint, callback, maxls, finite_diff_rel_step, **unknown_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">346</span> <span class="n">n_iterations</span> <span class="o">=</span> <span class="mi">0</span>
<span class="g g-Whitespace">    </span><span class="mi">348</span> <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">349</span>     <span class="c1"># x, f, g, wa, iwa, task, csave, lsave, isave, dsave = \</span>
<span class="ne">--&gt; </span><span class="mi">350</span>     <span class="n">_lbfgsb</span><span class="o">.</span><span class="n">setulb</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">low_bnd</span><span class="p">,</span> <span class="n">upper_bnd</span><span class="p">,</span> <span class="n">nbd</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">factr</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">351</span>                    <span class="n">pgtol</span><span class="p">,</span> <span class="n">wa</span><span class="p">,</span> <span class="n">iwa</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">iprint</span><span class="p">,</span> <span class="n">csave</span><span class="p">,</span> <span class="n">lsave</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">352</span>                    <span class="n">isave</span><span class="p">,</span> <span class="n">dsave</span><span class="p">,</span> <span class="n">maxls</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span>     <span class="n">task_str</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">354</span>     <span class="k">if</span> <span class="n">task_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;FG&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">355</span>         <span class="c1"># The minimization routine wants f and g at the current x.</span>
<span class="g g-Whitespace">    </span><span class="mi">356</span>         <span class="c1"># Note that interruptions due to maxfun are postponed</span>
<span class="g g-Whitespace">    </span><span class="mi">357</span>         <span class="c1"># until the completion of the current minimization iteration.</span>
<span class="g g-Whitespace">    </span><span class="mi">358</span>         <span class="c1"># Overwrite f and g:</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="plot-pressure-distributions-and-deformed-profiles">
<h2>plot pressure distributions and deformed profiles<a class="headerlink" href="#plot-pressure-distributions-and-deformed-profiles" title="Permalink to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nc</span> <span class="o">=</span> <span class="n">NCStructuredGrid</span><span class="p">(</span><span class="n">ncfilename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nc</span><span class="p">)):</span>

    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">axf</span><span class="p">,</span> <span class="n">axfcut</span><span class="p">,</span> <span class="n">axtopcut</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="n">axf</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">axf</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>

    <span class="n">axfcut</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">positions</span><span class="p">()[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">nc</span><span class="o">.</span><span class="n">pressures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="n">ny</span> <span class="o">//</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">axfcut</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">axfcut</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;pressures &quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="n">axfcut</span><span class="p">,</span> <span class="n">axtopcut</span><span class="p">):</span>
        <span class="n">a</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x &quot;</span><span class="p">)</span>
    <span class="n">axtopcut</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;height &quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axf</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="o">.</span><span class="n">positions</span><span class="p">(),</span> <span class="n">nc</span><span class="o">.</span><span class="n">pressures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;pressures&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axf</span><span class="p">)</span>
    <span class="n">axf</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">axtopcut</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">positions</span><span class="p">()[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="o">.</span><span class="n">heights</span><span class="p">()[:,</span> <span class="n">ny</span> <span class="o">//</span> <span class="mi">2</span><span class="p">],</span>
                  <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">)</span>
    <span class="n">axtopcut</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">positions</span><span class="p">()[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="o">.</span><span class="n">heights</span><span class="p">()[:,</span> <span class="n">ny</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">nc</span><span class="o">.</span><span class="n">elastic_displacements</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="n">ny</span> <span class="o">//</span> <span class="mi">2</span><span class="p">],</span>
                  <span class="n">c</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;deformed&quot;</span><span class="p">)</span>
    <span class="n">axtopcut</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Note that the pressures you see in the last plot are the numerical errors.</p>
</section>
<section id="scalar-quantities-during-loading">
<h2>Scalar quantities during loading<a class="headerlink" href="#scalar-quantities-during-loading" title="Permalink to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">penetration</span><span class="p">[:],</span> <span class="n">nc</span><span class="o">.</span><span class="n">normal_force</span><span class="p">[:],</span> <span class="s2">&quot;+-&quot;</span><span class="p">)</span>

<span class="n">contact_radii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">contact_area</span><span class="p">[:]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)),</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">JKR</span><span class="o">.</span><span class="n">penetration</span><span class="p">(</span><span class="n">contact_radius</span><span class="o">=</span><span class="n">contact_radii</span><span class="p">),</span> <span class="n">JKR</span><span class="o">.</span><span class="n">force</span><span class="p">(</span><span class="n">contact_radius</span><span class="o">=</span><span class="n">contact_radii</span><span class="p">),</span> <span class="s2">&quot;--k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;JKR&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;rigid body penetration $b^*$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Force $F^{*}$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">contact_radii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">contact_area</span><span class="p">[:]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)),</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">JKR</span><span class="o">.</span><span class="n">force</span><span class="p">(</span><span class="n">contact_radius</span><span class="o">=</span><span class="n">contact_radii</span><span class="p">),</span> <span class="n">contact_radii</span><span class="p">,</span> <span class="s2">&quot;--k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;JKR&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">normal_force</span><span class="p">[:],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">repulsive_area</span><span class="p">[:]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="s2">&quot;+-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;repulsive&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">normal_force</span><span class="p">[:],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">contact_area</span><span class="p">[:]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="s2">&quot;+-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;gap = 0&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Force ($F^*$)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Contact radius $\pi a^*$ &quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="further-experiments">
<h2>Further experiments<a class="headerlink" href="#further-experiments" title="Permalink to this heading"></a></h2>
<p>Decrease tthe number of grid points to 64 (increasing the pixel size by a factor of 4). Is the result still qualitatively accurate ?</p>
<p>Decreasing the interaction range will lead to similar issues (but requires more patience).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="adhesive_simulation_rough.html" class="btn btn-neutral float-right" title="Example of rough simulation with adhesion on the contact challenge 512x512 topography" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015-2020 The Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>